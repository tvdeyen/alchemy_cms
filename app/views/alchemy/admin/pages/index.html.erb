<% content_for :toolbar do %>
  <div class="toolbar_buttons">
    <%= render 'alchemy/admin/partials/site_select' %>
    <%= render 'alchemy/admin/partials/language_tree_select' %>
    <%= toolbar_button(
      icon: 'plus',
      label: Alchemy.t(:create_page),
      url: alchemy.new_admin_page_path,
      hotkey: 'alt+n',
      dialog_options: {
        title: Alchemy.t(:create_page),
        size: '340x220'
      },
      if_permitted_to: [:create, Alchemy::Page]
    ) %>
    <% if can?(:flush, Alchemy::Page) %>
      <div class="button_with_label">
        <%= link_to(
          render_icon(:eraser),
          alchemy.flush_admin_pages_path,
          remote: true,
          method: :post,
          class: 'icon_button please_wait',
          title: Alchemy.t('Flush page cache')
        ) %>
        <label><%= Alchemy.t('Flush page cache') %></label>
      </div>
    <% end %>
    <div class="button_with_label" id="clipboard_button">
      <%= link_to_dialog(
        render_icon(clipboard_empty?('pages') ? :clipboard : :paste),
        alchemy.admin_clipboard_path(remarkable_type: 'pages'),
        {
          title: Alchemy.t('Clipboard'),
          size: '380x305'
        },
        class: 'icon_button',
        title: Alchemy.t('Show clipboard')
      ) %>
      <label><%= Alchemy.t('Show clipboard') %></label>
    </div>
  </div>
  <%= render 'search_form', url: alchemy.admin_pages_path %>
<% end %>

<div id="archive_all" class="resources-table-wrapper">
  <% if @pages.any? %>
    <%= render 'alchemy/admin/resources/table_header' %>
    <%= render 'table' %>
  <% elsif can?(:create, Alchemy::Page) && !params[:q] %>
    <div class="panel no-resource-found">
      <%= render_message do %>
        <%= Alchemy.t(:no_resource_found) % { resource: Alchemy::Page.model_name.human } %>
      <% end %>
      <%= render 'new_page_form', page: @page %>
    </div>
  <% else %>
    <%= render 'alchemy/admin/resources/table_header' %>
    <%= render_message do %>
      <%= Alchemy.t(:no_search_results) %>
    <% end %>
  <% end %>
</div>

<script>
  $(function() {
    Alchemy.Pages.watchPagePublicationState()
    Alchemy.Pages.parentSelect({
      url: '<%= alchemy.api_pages_path %>',
      placeholder: '<%= Alchemy.t(:all_pages) %>',
      <% if @parent %>
      initialSelection: {
        id: <%= @parent.id %>,
        text: '<%= @parent.name %>'
      }
    <% end %>
    })
  })
</script>
